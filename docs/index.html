<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>rmapi-js</title><meta name="description" content="Documentation for rmapi-js"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">rmapi-js</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h2>rmapi-js</h2></div><div class="tsd-panel tsd-typography"><a id="md:rmapi-js" class="tsd-anchor"></a><h1><a href="#md:rmapi-js">rmapi-js</a></h1><p><a href="https://github.com/erikbrinkman/rmapi-js/actions/workflows/node.js.yml"><img src="https://github.com/erikbrinkman/rmapi-js/actions/workflows/node.js.yml/badge.svg" alt="build"></a>
<a href="https://erikbrinkman.github.io/rmapi-js/modules.html"><img src="https://img.shields.io/badge/docs-docs-blue" alt="docs"></a>
<a href="https://www.npmjs.com/package/rmapi-js"><img src="https://img.shields.io/npm/v/rmapi-js" alt="npm"></a>
<a href="LICENSE"><img src="https://img.shields.io/github/license/erikbrinkman/rmapi-js" alt="license"></a></p>
<p>JavaScript implementation of the reMarkable 1.5 api. This implementation is
built around web standards for fetch and crypto, but can easily be patched to
work for node. It should also be pretty easy to customize to work with
<a href="https://github.com/ddvk/rmfakecloud">rmfakecloud</a>, although that might take a
little bit of extra plumbing. At the current time it&#39;s only partially complete,
but has the backbone to be flushed out more.</p>
<p>This implementation is based off of <a href="https://github.com/juruen/rmapi"><code>rmapi</code></a>,
but aims to be a little simpler. Currently this does no direct handling of the
document tree or syncing efficiently with the cloud, although that support can
be build on top of this library. To make those calls efficient, it will be
helpful to supply a custom cache.</p>
<a id="md:api" class="tsd-anchor"></a><h2><a href="#md:api">API</a></h2><p>Before using this API it&#39;s necessary to have some rudimentary understanding of
how the API works.</p>
<p>All data is stored via its sha256 hash. This includes raw files and
&quot;collections&quot;, which have a special format listing all of their <code>Entry</code>s by
hash and id. Each document or folder is a collection of it&#39;s constituant files,
which inclue metadata about the object.  All documents and folders are in the
root collection, and there&#39;s a versioned hash which indicates the hash of the
root collection. The root hash version is it&#39;s &quot;generation&quot;.</p>
<a id="md:usage" class="tsd-anchor"></a><h2><a href="#md:usage">Usage</a></h2><p>To explore files in the cloud, you need to first register your api and persist
the token. Then you can use <code>getEntries</code> to explore entries of different file
collections.</p>
<pre><code class="language-ts"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">register</span><span class="hl-1">, </span><span class="hl-2">remarkable</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;rmapi-js&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">code</span><span class="hl-1"> = </span><span class="hl-3">&quot;...&quot;</span><span class="hl-1">  </span><span class="hl-6">// eight letter code from https://my.remarkable.com/device/desktop/connect</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">token</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-7">register</span><span class="hl-1">(</span><span class="hl-2">code</span><span class="hl-1">)</span><br/><span class="hl-6">// persist token</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">api</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-7">remarkable</span><span class="hl-1">(</span><span class="hl-2">token</span><span class="hl-1">);</span><br/><span class="hl-4">const</span><span class="hl-1"> [</span><span class="hl-5">root</span><span class="hl-1">] = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">api</span><span class="hl-1">.</span><span class="hl-7">getRootHash</span><span class="hl-1">();</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">fileEntries</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">api</span><span class="hl-1">.</span><span class="hl-7">getEntries</span><span class="hl-1">(</span><span class="hl-2">root</span><span class="hl-1">);</span><br/><span class="hl-0">for</span><span class="hl-1"> (</span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">entry</span><span class="hl-1"> </span><span class="hl-4">of</span><span class="hl-1"> </span><span class="hl-2">fileEntries</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">children</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">api</span><span class="hl-1">.</span><span class="hl-7">getEntries</span><span class="hl-1">(</span><span class="hl-2">entry</span><span class="hl-1">.</span><span class="hl-2">hash</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-0">for</span><span class="hl-1"> (</span><span class="hl-4">const</span><span class="hl-1"> { </span><span class="hl-5">hash</span><span class="hl-1">, </span><span class="hl-5">documentId</span><span class="hl-1"> } </span><span class="hl-4">of</span><span class="hl-1"> </span><span class="hl-2">children</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">documentId</span><span class="hl-1">.</span><span class="hl-7">endsWith</span><span class="hl-1">(</span><span class="hl-3">&quot;.metadata&quot;</span><span class="hl-1">)) {</span><br/><span class="hl-1">      </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">meta</span><span class="hl-1"> = </span><span class="hl-2">api</span><span class="hl-1">.</span><span class="hl-7">getMetadata</span><span class="hl-1">(</span><span class="hl-2">hash</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-6">// get metadata for entry</span><br/><span class="hl-1">      </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-7">log</span><span class="hl-1">(</span><span class="hl-2">meta</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>To upload an epub, simply call upload with the appropriate name and buffer.</p>
<pre><code class="language-ts"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">remarkable</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;rmapi-js&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">api</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-7">remarkable</span><span class="hl-1">(...);</span><br/><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">api</span><span class="hl-1">.</span><span class="hl-7">putEpub</span><span class="hl-1">(</span><span class="hl-3">&quot;document name&quot;</span><span class="hl-1">, </span><span class="hl-2">epubBuffer</span><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<p>Note that to actually update the reMarkable to display it, the root hash will
also need to be updated, see method documentation for more info.</p>
<a id="md:node" class="tsd-anchor"></a><h3><a href="#md:node">Node</a></h3><p>This uses web standards by default, so using within node takes a little more effort.</p>
<p>You need import the node crypto library and assign it to globals</p>
<pre><code class="language-js"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">webcrypto</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;crypto&quot;</span><span class="hl-1">;</span><br/><span class="hl-2">global</span><span class="hl-1">.</span><span class="hl-2">crypto</span><span class="hl-1"> = </span><span class="hl-2">webcrypto</span><span class="hl-1">;</span>
</code><button>Copy</button></pre>
<p>or optionally pass it into the constructor</p>
<pre><code class="language-js"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">webcrypto</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;crypto&quot;</span><span class="hl-1">;</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">api</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-7">remarkable</span><span class="hl-1">(</span><span class="hl-2">token</span><span class="hl-1">, { </span><span class="hl-2">digest:</span><span class="hl-1"> </span><span class="hl-2">webcrypto</span><span class="hl-1">.</span><span class="hl-2">subtle</span><span class="hl-1">.</span><span class="hl-2">digest</span><span class="hl-1"> });</span>
</code><button>Copy</button></pre>
<p>You also need to have a globally defined fetch. There are several ways to
accomplish this. In node 17.5 or higher you can enable global fetch with 
<code>node --experimental-fetch</code></p>
<p>You can also rely on <code>&quot;node-fetch&quot;</code> which is compliant enough</p>
<pre><code class="language-js"><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-2">fetch</span><span class="hl-1"> </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;node-fetch&quot;</span><span class="hl-1">;</span><br/><span class="hl-2">global</span><span class="hl-1">.</span><span class="hl-2">fetch</span><span class="hl-1"> = </span><span class="hl-2">fetch</span><span class="hl-1">;</span>
</code><button>Copy</button></pre>
<p>or</p>
<pre><code class="language-js"><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-2">fetch</span><span class="hl-1"> </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;node-fetch&quot;</span><span class="hl-1">;</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">api</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-7">remarkable</span><span class="hl-1">(</span><span class="hl-2">token</span><span class="hl-1">, { </span><span class="hl-2">fetch</span><span class="hl-1"> });</span>
</code><button>Copy</button></pre>
<a id="md:newer-api" class="tsd-anchor"></a><h3><a href="#md:newer-api">Newer API</a></h3><p>Recently I discovered the API the the Read on Remarkable extension uses, which
bypasses the syncing and fetching of the root hash. These APIs are pretty
limited but can be an easy first step.</p>
<pre><code class="language-js"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">remarkable</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;rmapi-js&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">api</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-7">remarkable</span><span class="hl-1">(...);</span><br/><span class="hl-6">// all the files and folders stored on the reMarkable, no roothash necessary</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">entries</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">api</span><span class="hl-1">.</span><span class="hl-7">getEntriesMetadata</span><span class="hl-1">();</span><br/><span class="hl-6">// upload epubs and pdfs without root hash</span><br/><span class="hl-6">// NOTE pdfs aren&#39;t currently working as expected</span><br/><span class="hl-6">// NOTE epub options aren&#39;t supported</span><br/><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">api</span><span class="hl-1">.</span><span class="hl-7">uploadEpub</span><span class="hl-1">(</span><span class="hl-3">&quot;name&quot;</span><span class="hl-1">, </span><span class="hl-2">buffer</span><span class="hl-1">);</span><br/><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">api</span><span class="hl-1">.</span><span class="hl-7">uploadPdf</span><span class="hl-1">(</span><span class="hl-3">&quot;name&quot;</span><span class="hl-1">, </span><span class="hl-2">buffer</span><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<a id="md:design" class="tsd-anchor"></a><h2><a href="#md:design">Design</a></h2><p>Building a full syncing version of the remarkable filesystem from the cloud API
is a project in and of itself, so I opted to only implement the primative calls
which should still be possible to compose into advanced functionality.</p>
<p>In order to make this as easily cross platform as possible, web standards were
chosen as the basis since they enjoy relative adoption in node. However, node
has middling support of webstreams and since none of the reading or writing is
that intensive or doesn&#39;t already require the whole file in memory, we opted to
process strings or ArrayBuffers ignoring Readable and WriteableStreams for the
time being.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-index-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><h4 class="uppercase">Member Visibility</h4><form><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div><div class="tsd-theme-toggle"><h4 class="uppercase">Theme</h4><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-index-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:rmapi-js"><span>rmapi-<wbr/>js</span></a><ul><li><a href="#md:api"><span>API</span></a></li><li><a href="#md:usage"><span>Usage</span></a></li><li><ul><li><a href="#md:node"><span>Node</span></a></li><li><a href="#md:newer-api"><span>Newer API</span></a></li></ul></li><li><a href="#md:design"><span>Design</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="assets/icons.svg#icon-1"></use></svg><span>rmapi-js</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li>Loading...</li></ul></nav></div></div></div><div class="tsd-generator"><p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div><div class="overlay"></div></body></html>